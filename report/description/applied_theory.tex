\section{Applied Theory}
\subsection{Definitions}
\index{acoustic feedback}\index{artifact}\index{howling}\index{sound reinforcement systems}
When most people talk about acoustic feedback they normally mean the unpleasant howling that can occur in sound reinforcement systems, technically this is wrong. Feedback is the mechanism of unwanted acoustic coupling between the speaker and the microphone, not the actual sound produced (called the howling). The unpleasant howling is called an \textit{artifact} and is but one of the artifacts that can occur as an result of acoustic feedback.

\subsection{Mathematical representation}
\index{mathematical models}
This representation of the problem is based on \cite{van_waterschoot_fifty_2011}. 

\index{state space model}
State space model can be seen from Figure \ref{feedmodel}. This is a model of $S$ sources, $S$ microphones and $L$ speakers.
\begin{figure}[H]
    \begin{center}
        \input{description/feed_model}
    \end{center}
    \caption{Discrete-time model of a Sound reinforcement system}
    \label{feedmodel}
\end{figure} 
Mathematically this can be represented as:
\begin{eqnarray}
\mathbf{y}= \mathbf{F}(q,t)\mathbf{u}(t) + \mathbf{v}(t)\\
\mathbf{u} = \mathbf{G}[\mathbf{y}(t),t]
\end{eqnarray}
The source signal $\mathbf{v}_i(t)$, microphone signal $\mathbf{y}_i(t)$ and loudspeaker signal vectors $\mathbf{u}_j(t)$ are defined as: 
\begin{eqnarray}
\mathbf{v}(t) = [v_1(t) \ldots v_S]^T \\
\mathbf{y}(t) = [y_1(t) \ldots y_S]^T \\
\mathbf{u}(t) = [u_1(t) \ldots v_L]^T
\end{eqnarray}
The matrix $\mathbf{F}(q,t)$ is the multi channel acoustic \textit{feedback path}, $\mathbf{G}(\cdot,t)$ is the electroacoustic forward path characteristics or \textit{forward path}.

Between each loudspeaker-microphone pair $(i,j)$ there exists an acoustic coupling, this is modeled by the nth order acoustic feedback path transfer function:
\begin{equation}
	F_{ij}(q,t) = f_{ij}^{(0)}(t) + f_{ij}^{(1)}(t)q^{-1} + \ldots + f_{ij}^{(n_F)}(t)q^{-n_F}
\end{equation}
$q$ is the discrete time shift operator: $q^{-k}f(t) = f(t-k)$.

We can define the feedback path as a matrix of all the possible couplings:
\begin{eqnarray}
\mathbf{F}(q,t) =
\begin{bmatrix}
F_{11}(q,t) & \ldots & F_{1L}(q,t)\\
\vdots & \ldots & \vdots\\
F_{S1}(q,t) & \ldots & F_{SL}(q,t)
\end{bmatrix}
\end{eqnarray}
The acoustic feedback path model is linear, time varying and of finite order \cite{van_waterschoot_fifty_2011}.\\

The proposed solution simplifies this path by assuming a single speaker a single microphone, this is not a unreasonable assumption since most sound reinforcement systems for speech consists of two speakers and one microphone. The simplified version of the feedback path seems good enough to provide a proof of concept. The resulting model for both the feedback and feed-forward path can be seen as scalar.\\

\subsection{Two-stage NHS}
\index{Notch-filter}
\nomenclature{NHS}{Notch filter Howling Suppression} 
The method used in this system is the two-stage Notch filter based Howling Suppression (NHS), this is a simple and reliable method that is commonly used in howling prevention \cite{van_waterschoot_fifty_2011}. The figure \ref{NHS_overview} shows the overall conceptual structure of the method.

\begin{figure}[H]
\centering
\includegraphics[width=14cm]{description/Figures/Two-stage_NHS-2}
\caption{Two-stage NHS structure}
\label{NHS_overview}
\end{figure}

In this figure \ref{NHS_overview} $G$ is the transfer function of the electro-acoustical feed forward path, $F$ is the feedback path, and $H$ is an equalizer that consists of a bank of adjustable notch-filters. The signals are given by non-capital letters where $v(t)$ is the wanted audio signal from the person or instrument in front of the microphone, $y(t)$ is one frame of samples of this signal in the time plane, $D$ is a vector of frequencies where howling has been detected, $d(t)$ is the signal after it has been filtered though the adjustable bank of notch-filters, $u(t)$ is the output to the speaker(s), $x(t)$ is the unwanted feedback signal.\\
\\
\index{howling}\index{feedback loop}
The howling detection is designed to detect howling and return a vector of frequencies on which howling is detected. These frequencies will correspond to a notch-filter in the equalizer, reducing the gain on these frequencies. Hopefully this reduction in frequency gain is enough to break the positive feedback loop end stop the howling. \\
\\
\index{power spectrum}
The howling detection scheme looks at the power spectrum of the signal and picks out peaks, these peaks are subjected to several tests. Peaks are tested for discriminating features between howling and a normal sinusoidal tone, since most tones have harmonic components the frequencies that have harmonics can be eliminated as a candidate for howling. The signals where no harmonics are detected is tested by looking at the following parameters:\\
\begin{itemize}
\index{PTPR}\index{PAPR}\index{PNPR}\index{IPMP}\index{PHPR}\index{IMSD}
\item Peak-to-threshold power ratio(PTPR)\nomenclature{PTPR}{Peak-to-threshold power ratio} 
\subitem between the peak magnitude and predefined constant magnitude
\item Peak-to-average power ratio(PAPR)\nomenclature{PAPR}{Peak-to-average power ratio} 
\subitem The ratio between the peak magnitude and the average of the signal
\item Peak-to-neighboring power ratio(PNPR)\nomenclature{PNPR}{Peak-to-neighboring power ratio} 
\subitem The ratio between the peak magnitude and other nearby peaks
\item Interframe peak magnitude persistence (IPMP)\nomenclature{IPMP}{Interframe peak magnitude persistence}
\subitem How persistent this peak is in a sample of previous frames

\item Peak-to-harmonic peak ratio(PHPR)\nomenclature{PHPR}{Peak-to-harmonic peak ratio}
\subitem The ratio between the peak magnitude and the magnitude of its first harmonic peak
\item Interframe magnitude slope deviation (IMSD)\nomenclature{IMSD}{Interframe magnitude slope deviation}
\subitem How the magnitude of this peak is changing over the previous frames
\end{itemize}
\index{howling}
Based on these parameters or a subset of these parameters a state of howling can be detected. The different ratios must be tuned to give good performance.
